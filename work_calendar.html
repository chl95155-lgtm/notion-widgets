<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Yellow Grid Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --main-yellow: #FBC02D; --soft-yellow: #FFF9C4; --bg-yellow: #FFFDE7; }
        body { background: transparent; font-family: 'Pretendard', sans-serif; margin: 0; padding: 10px; }
        .container { background: white; border: 3px solid var(--main-yellow); border-radius: 25px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .btn-auth { background: var(--main-yellow); color: white; border: none; padding: 8px 18px; border-radius: 12px; cursor: pointer; font-weight: bold; }
        #calendar { height: 750px; background: white; }
        /* ìº˜ë¦°ë” ë‚´ë¶€ ë…¸ë€ìƒ‰ ì»¤ìŠ¤í…€ */
        .fc-event { cursor: pointer; padding: 2px 4px; border-radius: 4px !important; font-size: 11px !important; font-weight: 500 !important; }
        .fc-daygrid-event { background-color: var(--soft-yellow) !important; border: 1px solid var(--main-yellow) !important; color: #5D4037 !important; }
        .fc-v-event { background-color: var(--main-yellow) !important; border: none !important; }
        .fc-day-today { background: var(--bg-yellow) !important; }
        .fc-button-primary { background-color: var(--main-yellow) !important; border: none !important; text-transform: capitalize !important; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2 style="margin:0; font-size:18px; color:#5D4037;">ğŸ’› 2026 ì—…ë¬´ ëŒ€ì‹œë³´ë“œ</h2>
        <button id="auth_button" class="btn-auth" onclick="handleAuthClick()">ë¡œê·¸ì¸</button>
    </div>
    <div id="calendar"></div>
</div>

<script>
    const CLIENT_ID = '582944285891-2benf275reb6i2o64d0bk5eh67okjlov.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDx-J1xtz2c1X7F7CZg1VKVbmlScDkBg8s';
    const CALENDAR_IDS = [
        'primary', 'chl95155@gmail.com', 
        'ko.south_korea#holiday@group.v.calendar.google.com'
    ];

    let calendar;
    let tokenClient;
    let gapiInited = false;

    // 1. FullCalendar ì´ˆê¸° ì„¤ì •
    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');
        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek' },
            dayMaxEvents: true, // ì¼ì •ì´ ë§ìœ¼ë©´ 'ë” ë³´ê¸°'ë¡œ í‘œì‹œ
            eventTimeFormat: { hour: '2-digit', minute: '2-digit', meridiem: false, hour12: false }
        });
        calendar.render();
    });

    // 2. êµ¬ê¸€ API ì—”ì§„ ë¡œë“œ
    function gapiLoaded() { gapi.load('client', async () => {
        await gapi.client.init({ apiKey: API_KEY, discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"] });
        gapiInited = true;
    });}

    // 3. ë¡œê·¸ì¸ ëª¨ë“ˆ ì´ˆê¸°í™”
    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID, scope: 'https://www.googleapis.com/auth/calendar.readonly', callback: ''
        });
    }

    function handleAuthClick() {
        tokenClient.callback = async (resp) => {
            if (resp.error) return;
            document.getElementById('auth_button').innerText = 'ë™ê¸°í™” ì¤‘...';
            await loadAllEvents();
            document.getElementById('auth_button').innerText = 'ë™ê¸°í™” ì™„ë£Œ';
        };
        tokenClient.requestAccessToken({prompt: 'consent'});
    }

    // 4. ëª¨ë“  ìº˜ë¦°ë”ì—ì„œ ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadAllEvents() {
        calendar.removeAllEvents(); // ê¸°ì¡´ ì¼ì • ì²­ì†Œ

        for (const id of CALENDAR_IDS) {
            try {
                const response = await gapi.client.calendar.events.list({
                    'calendarId': id,
                    'timeMin': (new Date()).toISOString(),
                    'showDeleted': false,
                    'singleEvents': true,
                    'orderBy': 'startTime'
                });

                const events = response.result.items.map(item => ({
                    title: item.summary,
                    start: item.start.dateTime || item.start.date,
                    end: item.end.dateTime || item.end.date,
                    allDay: !item.start.dateTime, // ì‹œê°„ì´ ì—†ìœ¼ë©´ ì¢…ì¼ ì¼ì •ìœ¼ë¡œ ì²˜ë¦¬
                    color: id.includes('holiday') ? '#FFCDD2' : '' // ê³µíœ´ì¼ì€ ì‚´ì§ ë‹¤ë¥¸ ìƒ‰ìœ¼ë¡œ
                }));

                calendar.addEventSource(events);
            } catch (err) {
                console.warn(id + " ë¡œë“œ ì‹¤íŒ¨:", err);
            }
        }
    }
</script>
<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>

