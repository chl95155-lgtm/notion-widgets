<script>
    const CLIENT_ID = '582944285891-2benf275reb6i2o64d0bk5eh67okjlov.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDx-J1xtz2c1X7F7CZg1VKVbmlScDkBg8s';
    
    // ... (CALENDAR_IDS 등 스타일 부분은 동일) ...

    let tokenClient;
    let gapiInited = false;
    let gisInited = false; // 추가: GIS 초기화 여부 체크

    async function initGapi() {
        if (gapiInited) return; // 이미 초기화 중이면 중단
        try {
            await new Promise((resolve) => gapi.load('client', resolve));
            await gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"]
            });
            gapiInited = true;
            updateStatus('gapi_status', '', true);
        } catch (e) {
            updateStatus('gapi_status', '실패', false, e.message);
        }
    }

    function initGis() {
        if (gisInited) return; // 추가
        try {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/calendar.readonly',
                callback: '', 
            });
            gisInited = true; // 추가
            updateStatus('gis_status', '', true);
        } catch (e) {
            updateStatus('gis_status', '실패', false);
        }
    }

    const timer = setInterval(() => {
        if (window.gapi && !gapiInited) initGapi();
        if (window.google && window.google.accounts && !gisInited) initGis();
        if (gapiInited && gisInited) clearInterval(timer);
    }, 1000);
    
    // ... (이하 handleAuthClick 및 일정 로드 로직 동일) ...
</script>

