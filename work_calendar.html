<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Yellow Work Calendar</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --main-yellow: #FBC02D; --soft-yellow: #FFF9C4; --bg-yellow: #FFFDE7; }
        body { background: transparent; font-family: 'Pretendard', sans-serif; margin: 0; padding: 10px; }
        .container { background: white; border: 3px solid var(--main-yellow); border-radius: 25px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--soft-yellow); padding-bottom: 10px; margin-bottom: 15px; }
        .header h2 { color: #5D4037; margin: 0; font-size: 18px; }
        .btn-auth { background: var(--main-yellow); color: white; border: none; padding: 10px 18px; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-auth:hover { background: #F9A825; }
        .event-card { background: var(--bg-yellow); border-left: 5px solid var(--main-yellow); padding: 10px; margin-bottom: 8px; border-radius: 8px; text-align: left; }
        .event-time { font-size: 11px; color: #795548; font-weight: bold; }
        .event-title { font-size: 13px; color: #3E2723; margin-top: 3px; font-weight: 500; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2>ğŸ’› ì—…ë¬´ ì¼ì •</h2>
        <button id="auth_button" class="btn-auth" onclick="handleAuthClick()">ë¡œê·¸ì¸</button>
    </div>
    <div id="content" style="font-size: 13px; color: #888;">ë¡œê·¸ì¸ì„ ëˆŒëŸ¬ ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</div>
</div>

<script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
<script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script>
    const CLIENT_ID = '582944285891-2benf275reb6i2o64d0bk5eh67okjlov.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDx-J1xtz2c1X7F7CZg1VKVbmlScDkBg8s';
    
    // ë³´ê³  ì‹¶ì€ ìº˜ë¦°ë” IDë“¤ (ì •ë¦¬ ì™„ë£Œ)
    const CALENDAR_IDS = [
        'primary', 
        '2ajtn021gaspbcms3vt8lnlqo@group.calendar.google.com', 
        'chl95155@gmail.com', 
        'f45f8eb9f500085735d5c1d118b77c00d01462f269d4601a7fe40244fa213ed2@group.calendar.google.com', 
        'ko.south_korea#holiday@group.v.calendar.google.com'
    ];

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;

    function gapiLoaded() { gapi.load('client', initializeGapiClient); }
    async function initializeGapiClient() {
        await gapi.client.init({ apiKey: API_KEY, discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"] });
        gapiInited = true;
    }
    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({ client_id: CLIENT_ID, scope: 'https://www.googleapis.com/auth/calendar.readonly', callback: '' });
        gisInited = true;
    }

    function handleAuthClick() {
        if (!tokenClient) {
            alert("ì„œë¹„ìŠ¤ê°€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!");
            return;
        }
        tokenClient.callback = async (resp) => {
            if (resp.error !== undefined) throw (resp);
            document.getElementById('auth_button').innerText = 'ë™ê¸°í™” ì™„ë£Œ';
            await listUpcomingEvents();
        };
        tokenClient.requestAccessToken({prompt: 'consent'});
    }

    async function listUpcomingEvents() {
        let allEvents = [];
        try {
            for (const id of CALENDAR_IDS) {
                const response = await gapi.client.calendar.events.list({
                    'calendarId': id, 
                    'timeMin': (new Date()).toISOString(), 
                    'showDeleted': false, 
                    'singleEvents': true, 
                    'maxResults': 5, 
                    'orderBy': 'startTime'
                });
                if (response.result.items) allEvents = allEvents.concat(response.result.items);
            }
            allEvents.sort((a, b) => new Date(a.start.dateTime || a.start.date) - new Date(b.start.dateTime || b.start.date));
            
            const content = document.getElementById('content');
            content.innerHTML = allEvents.map(event => `
                <div class="event-card">
                    <div class="event-time">${new Date(event.start.dateTime || event.start.date).toLocaleString('ko-KR', {hour:'2-digit', minute:'2-digit'})}</div>
                    <div class="event-title">${event.summary}</div>
                </div>
            `).join('') || 'ì˜¤ëŠ˜ ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.';
        } catch (err) {
            document.getElementById('content').innerText = "ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            console.error(err);
        }
    }
</script>
</body>
</html>
