<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Yellow Work Dashboard</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --main-yellow: #FBC02D; --soft-yellow: #FFF9C4; --bg-yellow: #FFFDE7; }
        body { background: transparent; font-family: 'Pretendard', sans-serif; margin: 0; padding: 10px; }
        .container { background: white; border: 3px solid var(--main-yellow); border-radius: 25px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--soft-yellow); padding-bottom: 10px; margin-bottom: 15px; }
        .header h2 { color: #5D4037; margin: 0; font-size: 18px; }
        .btn-auth { background: var(--main-yellow); color: white; border: none; padding: 10px 18px; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .btn-auth:disabled { background: #eee; color: #aaa; }
        .status-box { font-size: 11px; color: #888; text-align: left; background: #fdfdfd; padding: 10px; border-radius: 10px; border: 1px solid #eee; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2>ğŸ’› ì—…ë¬´ ì¼ì •</h2>
        <button id="auth_button" class="btn-auth" onclick="handleAuthClick()" disabled>ì¤€ë¹„ ì¤‘...</button>
    </div>
    <div id="content">
        <div class="status-box" id="status_log">âš¡ ì‹œìŠ¤í…œ ì—”ì§„ ì˜ˆì—´ ì¤‘...</div>
    </div>
</div>

<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client"></script>

<script>
    const CLIENT_ID = '582944285891-2benf275reb6i2o64d0bk5eh67okjlov.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDx-J1xtz2c1X7F7CZg1VKVbmlScDkBg8s';
    const CALENDAR_IDS = ['primary', 'chl95155@gmail.com', 'ko.south_korea#holiday@group.v.calendar.google.com'];

    let tokenClient;
    const logEl = document.getElementById('status_log');

    function log(msg) { logEl.innerHTML += `<br>â€¢ ${msg}`; }

    // 1. API ë° ë¡œê·¸ì¸ ëª¨ë“ˆ ì´ˆê¸°í™”
    window.onload = () => {
        log("ì—”ì§„ ë¡œë“œ ì™„ë£Œ âœ…");
        try {
            gapi.load('client', async () => {
                await gapi.client.init({ apiKey: API_KEY, discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"] });
                log("ë°ì´í„° í†µë¡œ ì—°ê²° ì™„ë£Œ âœ…");
                
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID, scope: 'https://www.googleapis.com/auth/calendar.readonly', callback: ''
                });
                log("ë¡œê·¸ì¸ ì¤€ë¹„ ì™„ë£Œ âœ…");

                const btn = document.getElementById('auth_button');
                btn.innerText = 'ë¡œê·¸ì¸';
                btn.disabled = false;
            });
        } catch (e) {
            log("âŒ ì´ˆê¸°í™” ì˜¤ë¥˜: " + e.message);
        }
    };

    function handleAuthClick() {
        tokenClient.callback = async (resp) => {
            if (resp.error) return;
            logEl.innerText = "ì¼ì •ì„ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...";
            await loadEvents();
        };
        tokenClient.requestAccessToken({prompt: 'consent'});
    }

    async function loadEvents() {
        let events = [];
        for (const id of CALENDAR_IDS) {
            try {
                const res = await gapi.client.calendar.events.list({
                    'calendarId': id, 'timeMin': new Date().toISOString(), 'singleEvents': true, 'orderBy': 'startTime', 'maxResults': 5
                });
                if (res.result.items) events = events.concat(res.result.items);
            } catch (e) {}
        }
        events.sort((a, b) => new Date(a.start.dateTime || a.start.date) - new Date(b.start.dateTime || b.start.date));
        
        document.getElementById('content').innerHTML = events.slice(0, 10).map(e => `
            <div style="background:#FFFDE7; border-left:5px solid #FBC02D; padding:10px; margin-bottom:8px; border-radius:8px; text-align:left;">
                <div style="font-size:11px; color:#795548; font-weight:bold;">${new Date(e.start.dateTime || e.start.date).toLocaleString('ko-KR', {hour:'2-digit', minute:'2-digit'})}</div>
                <div style="font-size:13px; color:#3E2723; font-weight:500;">${e.summary}</div>
            </div>
        `).join('') || 'ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.';
    }
</script>
</body>
</html>
