<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Yellow Grid Calendar</title>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --main-yellow: #FBC02D; --soft-yellow: #FFF9C4; --bg-yellow: #FFFDE7; }
        body { background: transparent; font-family: 'Pretendard', sans-serif; margin: 0; padding: 10px; }
        .container { background: white; border: 3px solid var(--main-yellow); border-radius: 25px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .btn-auth { background: var(--main-yellow); color: white; border: none; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        /* ìº˜ë¦°ë” ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        #calendar { max-width: 100%; height: 600px; font-size: 13px; }
        .fc-header-toolbar { font-size: 14px; }
        .fc-button-primary { background-color: var(--main-yellow) !important; border-color: var(--main-yellow) !important; }
        .fc-daygrid-event { background-color: var(--soft-yellow) !important; border: 1px solid var(--main-yellow) !important; color: #5D4037 !important; border-radius: 5px !important; }
        .fc-day-today { background-color: var(--bg-yellow) !important; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2 style="margin:0; font-size:18px; color:#5D4037;">ğŸ’› ì—…ë¬´ ëŒ€ì‹œë³´ë“œ</h2>
        <button id="auth_button" class="btn-auth" onclick="handleAuthClick()">ë¡œê·¸ì¸</button>
    </div>
    <div id="calendar"></div>
</div>

<script>
    const CLIENT_ID = '582944285891-2benf275reb6i2o64d0bk5eh67okjlov.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDx-J1xtz2c1X7F7CZg1VKVbmlScDkBg8s';
    const CALENDAR_IDS = ['primary', 'chl95155@gmail.com', 'ko.south_korea#holiday@group.v.calendar.google.com'];

    let calendar;
    let tokenClient;

    // 1. ìº˜ë¦°ë” ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');
        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek' },
            height: 'auto'
        });
        calendar.render();
    });

    // 2. êµ¬ê¸€ ì¸ì¦ ë¡œë“œ
    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID, scope: 'https://www.googleapis.com/auth/calendar.readonly', callback: ''
        });
    }

    function handleAuthClick() {
        tokenClient.callback = async (resp) => {
            if (resp.error) return;
            document.getElementById('auth_button').innerText = 'ë™ê¸°í™” ì™„ë£Œ';
            await loadEvents();
        };
        tokenClient.requestAccessToken({prompt: 'consent'});
    }

    async function loadEvents() {
        // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±°
        calendar.getEvents().forEach(event => event.remove());

        for (const id of CALENDAR_IDS) {
            const response = await fetch(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(id)}/events?key=${API_KEY}&timeMin=${new Date().toISOString()}`);
            const data = await response.json();
            
            if (data.items) {
                data.items.forEach(item => {
                    calendar.addEvent({
                        title: item.summary,
                        start: item.start.dateTime || item.start.date,
                        end: item.end.dateTime || item.end.date,
                        description: item.description
                    });
                });
            }
        }
    }
</script>
<script async defer src="https://apis.google.com/js/api.js"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
