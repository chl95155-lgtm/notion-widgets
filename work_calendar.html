<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Yellow Work Calendar</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --main-yellow: #FBC02D; --soft-yellow: #FFF9C4; --bg-yellow: #FFFDE7; }
        body { background: transparent; font-family: 'Pretendard', sans-serif; margin: 0; padding: 10px; }
        .container { background: white; border: 3px solid var(--main-yellow); border-radius: 25px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--soft-yellow); padding-bottom: 10px; margin-bottom: 15px; }
        .header h2 { color: #5D4037; margin: 0; font-size: 18px; }
        .btn-auth { background: var(--main-yellow); color: white; border: none; padding: 10px 18px; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-auth:disabled { background: #eee; color: #aaa; cursor: not-allowed; }
        .event-card { background: var(--bg-yellow); border-left: 5px solid var(--main-yellow); padding: 10px; margin-bottom: 8px; border-radius: 8px; text-align: left; }
        .event-time { font-size: 11px; color: #795548; font-weight: bold; }
        .event-title { font-size: 13px; color: #3E2723; margin-top: 3px; font-weight: 500; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2>ğŸ’› ì—…ë¬´ ì¼ì •</h2>
        <button id="auth_button" class="btn-auth" onclick="handleAuthClick()" disabled>ì¤€ë¹„ ì¤‘...</button>
    </div>
    <div id="content" style="font-size: 13px; color: #888;">ì—°ê²° ìƒíƒœë¥¼ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤...</div>
</div>

<script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
<script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>

<script>
    // [í™•ì¸ ì™„ë£Œ] ì²­ì•„ë‹˜ì˜ í‚¤ì™€ ìº˜ë¦°ë” IDë“¤ì…ë‹ˆë‹¤.
    const CLIENT_ID = '582944285891-2benf275reb6i2o64d0bk5eh67okjlov.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDx-J1xtz2c1X7F7CZg1VKVbmlScDkBg8s';
    
    const CALENDAR_IDS = [
        'primary', 
        '2ajtn021gaspbcms3vt8lnlqo@group.calendar.google.com', 
        'chl95155@gmail.com', 
        'f45f8eb9f500085735d5c1d118b77c00d01462f269d4601a7fe40244fa213ed2@group.calendar.google.com', 
        'ko.south_korea#holiday@group.v.calendar.google.com'
    ];

    let tokenClient;
    let gapiInited = false;

    // 1. GAPI ì´ˆê¸°í™”
    function gapiLoaded() { gapi.load('client', initializeGapiClient); }
    async function initializeGapiClient() {
        try {
            await gapi.client.init({ apiKey: API_KEY, discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"] });
            gapiInited = true;
            checkReady();
        } catch (e) { document.getElementById('content').innerText = "API í‚¤ ì˜¤ë¥˜: " + e.message; }
    }

    // 2. GIS(ë¡œê·¸ì¸ ë„êµ¬) ì´ˆê¸°í™”
    function gisLoaded() {
        try {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/calendar.readonly',
                callback: '', // ë‚˜ì¤‘ì— ì •ì˜
            });
            checkReady();
        } catch (e) { document.getElementById('content').innerText = "í´ë¼ì´ì–¸íŠ¸ ID ì˜¤ë¥˜: " + e.message; }
    }

    // 3. ë‘˜ ë‹¤ ì¤€ë¹„ë˜ë©´ ë²„íŠ¼ í™œì„±í™”
    function checkReady() {
        if (gapiInited && tokenClient) {
            const btn = document.getElementById('auth_button');
            btn.innerText = 'ë¡œê·¸ì¸';
            btn.disabled = false;
            document.getElementById('content').innerText = 'ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
        }
    }

    function handleAuthClick() {
        tokenClient.callback = async (resp) => {
            if (resp.error !== undefined) throw (resp);
            document.getElementById('auth_button').innerText = 'ë™ê¸°í™” ì¤‘...';
            await listUpcomingEvents();
        };
        tokenClient.requestAccessToken({prompt: 'consent'});
    }

    async function listUpcomingEvents() {
        let allEvents = [];
        try {
            for (const id of CALENDAR_IDS) {
                const response = await gapi.client.calendar.events.list({
                    'calendarId': id, 
                    'timeMin': (new Date()).toISOString(), 
                    'showDeleted': false, 
                    'singleEvents': true, 
                    'maxResults': 5, 
                    'orderBy': 'startTime'
                });
                if (response.result.items) allEvents = allEvents.concat(response.result.items);
            }
            allEvents.sort((a, b) => new Date(a.start.dateTime || a.start.date) - new Date(b.start.dateTime || b.start.date));
            
            const content = document.getElementById('content');
            content.innerHTML = allEvents.map(event => `
                <div class="event-card">
                    <div class="event-time">${new Date(event.start.dateTime || event.start.date).toLocaleString('ko-KR', {hour:'2-digit', minute:'2-digit'})}</div>
                    <div class="event-title">${event.summary}</div>
                </div>
            `).slice(0, 10).join('') || 'ì˜¤ëŠ˜ ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.';
            document.getElementById('auth_button').innerText = 'ë™ê¸°í™” ì™„ë£Œ';
        } catch (err) {
            document.getElementById('content').innerText = "ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: " + err.message;
        }
    }
</script>
</body>
</html>
</script>
</body>
</html>

