<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Yellow Work Dashboard</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --main-yellow: #FBC02D; --soft-yellow: #FFF9C4; --bg-yellow: #FFFDE7; }
        body { background: transparent; font-family: 'Pretendard', sans-serif; margin: 0; padding: 10px; min-height: 200px; }
        .container { background: white; border: 3px solid var(--main-yellow); border-radius: 25px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--soft-yellow); padding-bottom: 10px; margin-bottom: 15px; }
        .header h2 { color: #5D4037; margin: 0; font-size: 18px; }
        .btn-auth { background: var(--main-yellow); color: white; border: none; padding: 10px 18px; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .btn-auth:disabled { background: #eee; color: #aaa; cursor: not-allowed; }
        .event-card { background: var(--bg-yellow); border-left: 5px solid var(--main-yellow); padding: 10px; margin-bottom: 8px; border-radius: 8px; text-align: left; }
        .status-msg { font-size: 12px; color: #888; margin-top: 10px; text-align: left; background: #fdfdfd; padding: 10px; border-radius: 10px; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2>ğŸ’› ì—…ë¬´ ì¼ì •</h2>
        <button id="auth_button" class="btn-auth" onclick="handleAuthClick()" disabled>ì¤€ë¹„ ì¤‘...</button>
    </div>
    <div id="content">
        <div class="status-msg" id="status_log">ğŸš€ ì‹œìŠ¤í…œ ê°€ë™ ì‹œì‘...</div>
    </div>
</div>

<script>
    // [ì„¤ì •] ì²­ì•„ë‹˜ì˜ ê³ ìœ  ì—´ì‡ ë“¤
    const CLIENT_ID = '582944285891-2benf275reb6i2o64d0bk5eh67okjlov.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDx-J1xtz2c1X7F7CZg1VKVbmlScDkBg8s';
    const CALENDAR_IDS = [
        'primary', '2ajtn021gaspbcms3vt8lnlqo@group.calendar.google.com', 
        'chl95155@gmail.com', 'f45f8eb9f500085735d5c1d118b77c00d01462f269d4601a7fe40244fa213ed2@group.calendar.google.com', 
        'ko.south_korea#holiday@group.v.calendar.google.com'
    ];

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;

    function log(msg) { document.getElementById('status_log').innerHTML += `<br>â€¢ ${msg}`; }

    // 1. GAPI ë¡œë“œ
    async function initGapi() {
        try {
            await new Promise((resolve) => gapi.load('client', resolve));
            await gapi.client.init({ apiKey: API_KEY, discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"] });
            gapiInited = true;
            log("ë°ì´í„° ì—”ì§„ ì¤€ë¹„ ì™„ë£Œ âœ…");
            checkReady();
        } catch (e) { log("âŒ ì—”ì§„ ì˜¤ë¥˜: " + e.message); }
    }

    // 2. GIS ë¡œë“œ
    function initGis() {
        try {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID, scope: 'https://www.googleapis.com/auth/calendar.readonly', callback: ''
            });
            gisInited = true;
            log("ë¡œê·¸ì¸ ëª¨ë“ˆ ì¤€ë¹„ ì™„ë£Œ âœ…");
            checkReady();
        } catch (e) { log("âŒ ë¡œê·¸ì¸ ëª¨ë“ˆ ì˜¤ë¥˜: " + e.message); }
    }

    function checkReady() {
        if (gapiInited && gisInited) {
            const btn = document.getElementById('auth_button');
            btn.innerText = 'ë¡œê·¸ì¸';
            btn.disabled = false;
            log("ëª¨ë“  ì¤€ë¹„ê°€ ëë‚¬ìŠµë‹ˆë‹¤!");
        }
    }

    // ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ê°ì‹œ (1ì´ˆ ê°„ê²©)
    const checkTimer = setInterval(() => {
        if (window.gapi && !gapiInited) initGapi();
        if (window.google && window.google.accounts && !gisInited) initGis();
        if (gapiInited && gisInited) clearInterval(checkTimer);
    }, 1000);

    function handleAuthClick() {
        tokenClient.callback = async (resp) => {
            if (resp.error) {
                log("âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + resp.error);
                return;
            }
            document.getElementById('auth_button').innerText = 'ë™ê¸°í™” ì¤‘...';
            await loadEvents();
        };
        tokenClient.requestAccessToken({prompt: 'consent'});
    }

    async function loadEvents() {
        let events = [];
        for (const id of CALENDAR_IDS) {
            try {
                const res = await gapi.client.calendar.events.list({
                    'calendarId': id, 'timeMin': new Date().toISOString(), 'showDeleted': false, 'singleEvents': true, 'maxResults': 5, 'orderBy': 'startTime'
                });
                if (res.result.items) events = events.concat(res.result.items);
            } catch (e) { console.warn(id + " ë¡œë“œ ì‹¤íŒ¨"); }
        }
        events.sort((a, b
