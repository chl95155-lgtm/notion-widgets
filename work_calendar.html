<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Yellow Grid Calendar</title>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        :root { --calendar-border: #FBC02D; --header-brown: #5D4037; }
        body { background: transparent; font-family: 'Noto Sans KR', sans-serif; margin: 0; padding: 5px; }
        .container { background: white; border: 3px solid var(--calendar-border); border-radius: 25px; padding: 15px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .btn-auth { background: var(--calendar-border); color: white; border: none; padding: 8px 16px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        #error-display { color: red; font-size: 12px; margin-top: 10px; text-align: center; white-space: pre-wrap; }
        #calendar { height: 600px; background: white; }
        .fc-event { cursor: pointer; padding: 3px 6px !important; border-radius: 4px !important; display: block !important; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2 style="color:var(--header-brown); margin:0;">ğŸ”” Calendar</h2>
        <button id="auth_button" class="btn-auth" onclick="handleAuthClick()">ë¡œê·¸ì¸</button>
    </div>
    <div id="error-display"></div> <div id="calendar"></div>
</div>

<script>
    const CLIENT_ID = '582944285891-2benf275reb6i2o64d0bk5eh67okjlov.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDx-J1xtz2c1X7F7CZg1VKVbmlScDkBg8s';
    
    // 2. 'l'ì´ í¬í•¨ëœ ì •í™•í•œ ID í™•ì¸ ì™„ë£Œ
    const CALENDAR_CONFIG = [
        { id: 'ko.south_korea#holiday@group.v.calendar.google.com', color: '#FFCDD2' }, 
        { id: 'chl95155@gmail.com', color: '#efbbff' }, 
        { id: '2ajtn021gaspbclms3vt8lnlqo@group.calendar.google.com', color: '#e0d6ff' }, 
        { id: 'f45f8eb9f500085735d5c1d118b77c00d01462f269d4601a7fe40244fa213ed2@group.calendar.google.com', color: '#e8f4ea' }
    ];

    let calendar;
    let tokenClient;

    document.addEventListener('DOMContentLoaded', function() {
        calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
            initialView: 'dayGridMonth', locale: 'ko', height: 'auto',
            headerToolbar: { left: 'today prev,next', center: 'title', right: '' }
        });
        calendar.render();
    });

    function gapiLoaded() {
        gapi.load('client', async () => {
            await gapi.client.init({ apiKey: API_KEY, discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"] });
        });
    }

    function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID, scope: 'https://www.googleapis.com/auth/calendar.readonly',
            callback: async (resp) => {
                if (resp.error) {
                    document.getElementById('error-display').innerText = "ì¸ì¦ ì—ëŸ¬: " + resp.error;
                    return;
                }
                await loadAllEvents();
                document.getElementById('auth_button').innerText = 'ë™ê¸°í™” ì™„ë£Œ';
            }
        });
    }

    function handleAuthClick() {
        tokenClient.requestAccessToken({prompt: 'consent'});
    }

    async function loadAllEvents() {
        calendar.removeAllEvents();
        let errorMsg = "";
        for (const config of CALENDAR_CONFIG) {
            try {
                const response = await gapi.client.calendar.events.list({ 'calendarId': config.id, 'timeMin': (new Date(2026, 0, 1)).toISOString(), 'singleEvents': true });
                const events = response.result.items.map(item => ({
                    title: item.summary, start: item.start.dateTime || item.start.date, end: item.end.dateTime || item.end.date, backgroundColor: config.color, borderColor: config.color, display: 'block'
                }));
                calendar.addEventSource(events);
            } catch (err) {
                // 3. ì—ëŸ¬ ë°œìƒ ì‹œ í™”ë©´ì— ì¦‰ì‹œ í‘œì‹œ
                errorMsg += `${config.id}: ${err.result.error.message}\n`;
                document.getElementById('error-display').innerText = errorMsg;
            }
        }
    }
</script>
<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
